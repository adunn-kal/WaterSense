<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME507 Utility Library: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ME507 Utility Library
   &#160;<span id="projectnumber">0.2.1</span>
   </div>
   <div id="projectbrief">Mechatronics Course Support Software for ARM/Arduino/FreeRTOS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ME507 Utility Library Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="s_intro"></a>
Introduction</h1>
<p>This library supports the programming of microcontrollers for the ME507 mechatronics course at California Polytechnic State University, San Luis Obispo. It contains some C++ "wrapper" classes which facilitate the use of FreeRTOS for efficient multitasking on microcontrollers.</p>
<h1><a class="anchor" id="s_tasks"></a>
Tasks</h1>
<p>The ME507 library uses FreeRTOS tasks with essentially no modifications. Using the library requires the following <code>#include</code> lines: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Arduino.h&gt;</span></div>
<div class="line"><span class="preprocessor">#if defined (STM32L4xx || defined STM32F4xx)</span></div>
<div class="line"><span class="preprocessor">    #include &lt;STM32FreeRTOS.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &lt;PrintStream.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="taskshare_8h.html">taskshare.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="taskqueue_8h.html">taskqueue.h</a>&quot;</span></div>
</div><!-- fragment --><p> The <code>#if</code> <code>defined</code> directive is used to include a library only when an STM32 processor is being used. If your project will never use an STM32 processor, those three lines may be left out, and it it will only ever run on an STM32, the <code>#include</code> <code>&lt;STM32FreeRTOS.h&gt;</code> may be used without the <code>#if</code> directive around it.</p>
<p>Each task is implemented by writing a task function; all task functions have the following form: </p><div class="fragment"><div class="line"><span class="comment">/** @brief   Task function which measures the heart rate of a loon.</span></div>
<div class="line"><span class="comment"> *  @details The details aren&#39;t important; this is just an example.</span></div>
<div class="line"><span class="comment"> *  @param   p_params A pointer to function parameters which we don&#39;t use.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> task_loony_heart (<span class="keywordtype">void</span>* p_params)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Setup code: Create variable(s) and initialize hardware</span></div>
<div class="line">    int16_t birdy_rate;</div>
<div class="line">    avian_HRM.init (-32.2);</div>
<div class="line">    <span class="keywordflow">for</span> (;;)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Measure and save heart rate</span></div>
<div class="line">        birdy_rate = avian_HRM.measure ();</div>
<div class="line">        my_SD_card.store (birdy_rate);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Run the loop code every ~2.5 seconds</span></div>
<div class="line">        vTaskDelay (2500);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> A task function such as the one above is run by the FreeRTOS scheduler after the scheduler has been started. The task must be registered with the scheduler through the use of the <code>xTaskCreate()</code> function: </p><div class="fragment"><div class="line"><span class="comment">// Create a task which measures shorebird pulmonary function</span></div>
<div class="line">xTaskCreate (task_loony_heart,     <span class="comment">// Task function</span></div>
<div class="line">             <span class="stringliteral">&quot;Send&quot;</span>,               <span class="comment">// Name shown on printouts</span></div>
<div class="line">             256,                  <span class="comment">// Stack size</span></div>
<div class="line">             NULL,                 <span class="comment">// Parameters for task function</span></div>
<div class="line">             3,                    <span class="comment">// Priority</span></div>
<div class="line">             NULL);                <span class="comment">// Place to save task handle, if used</span></div>
</div><!-- fragment --><p> The FreeRTOS scheduler may or may not need to be started, depending on the processor being used. See the platform-specific notes below for details.</p>
<h1><a class="anchor" id="s_shares"></a>
Shares</h1>
<p>The term "shared variables" is used herein to mean variables which carry information from one task to another. Shares are used to communicate data whose current value is important but whose history is not; previous values of a shared variable are assumed to be unimportant, as they are overwritten whenever a new value is put into the share. The shared variables used here are different from ordinary global variables in that these shares employ protection mechanisms to ensure that data transmitted from one task to another is not corrupted due to the RTOS switching between tasks using an interrupt based mechanism. Ordinary global variables are not <em>thread-safe</em> and must not be used to exchange data between tasks.</p>
<p>See the documentation for <code>class</code> <code><a class="el" href="classShare.html" title="Class for data to be shared in a thread-safe manner between tasks.">Share</a></code> for information on how to use these shared variable objects. Expand the <em>Classes</em> category in the navigation bar to find this documentation.</p>
<h1><a class="anchor" id="s_queues"></a>
Queues</h1>
<p>Queues are used to communicate data between tasks in such a way that older data is <em>not</em> lost when new data is placed into a queue. This is done through the use of a buffer in each queue; it's a bit like polite people standing in line. The receiving task removes (gets) data from the queue in the order in which data was put into the queue by the sending task.</p>
<p>See the documentation for <code>class</code> <code><a class="el" href="classQueue.html" title="Implements a queue to transmit data from one RTOS task to another.">Queue</a></code> for information on how to use this wrapper class to implement inter-task queues. Expand the <em>Classes</em> category in the navigation bar to find this documentation.</p>
<p>There is also a queue for text, <code>class</code> <code><a class="el" href="classTextQueue.html" title="Implements a queue to transmit text from one RTOS task to another.">TextQueue</a></code>. A queue made from this class can only hold characters of type <code>char</code>, but it can be written using the stream insertion operator <code>&lt;&lt;</code>. This is convenient when one task wants to write quick bursts of data to a slow receiving device such as a serial terminal or SD card.</p>
<h1><a class="anchor" id="s_plat"></a>
Platform-Specific Notes</h1>
<p>The <b>ESP32</b> port of the Arduino environment has FreeRTOS support build in, and FreeRTOS tasks can be used without any special effort. When <code>setup()</code> is running, tasks can be created using <code>xTaskCreate()</code> and will begin to run as soon as they have been created. The Arduino header must be included, and we like to use the Arduino-PrintStream library as well. See below for the necessary <code>#include</code> lines.</p>
<p>The <b>STM32</b> port of Arduino requires some extra effort. The STM32FreeRTOS software must be attached. In addition, the scheduler must be explicitly started; this is not the case for many other FreeRTOS Arduino ports. To start the FreeRTOS scheduled for STM32's, place the following lines as the last lines in function <code>setup()</code>: </p><div class="fragment"><div class="line"><span class="preprocessor">#if defined (STM32L4xx || defined STM32F4xx)</span></div>
<div class="line">    vTaskStartScheduler ();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p> If your code will only ever run on an STM32, you may omit the preprocessor directives and always call <code>vTaskStartScheduler()</code>.</p>
<h1><a class="anchor" id="s_hardware"></a>
Hardware</h1>
<p>This software is designed to run on most microcontroller platforms using ARM Cortex&trade; processors. Boards which are specifically supported for the ME507 course are STM32 Nucleo-64&trade; boards with the STM32L476RG and the KeeYees&trade; board with an ESP-WROOM-32 module. Many other boards should work fine as long as they are supported by the Arduino environment. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="ataskshare_8h_html"><div class="ttname"><a href="taskshare_8h.html">taskshare.h</a></div><div class="ttdoc">Data which can be shared between tasks in a thread-safe manner.</div></div>
<div class="ttc" id="ataskqueue_8h_html"><div class="ttname"><a href="taskqueue_8h.html">taskqueue.h</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
